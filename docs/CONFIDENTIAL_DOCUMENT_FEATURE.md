# 機密文件提示功能

## 功能說明

當使用者嘗試下載失效或無法訪問的文件時，系統會顯示一個友善的提示視窗，告知使用者「此為機密文件，請洽站長」，而不是顯示 404 錯誤頁面。

## 修改內容

### 前端修改 (`src/views/DocumentsView.vue`)

1. **新增機密文件提示模態視窗**
   - 使用 Bulma 的 modal 元件
   - 警告圖示和黃色主題
   - 清楚的提示訊息

2. **改進下載錯誤處理**
   - 捕捉 404 錯誤
   - 捕捉無效 URL 錯誤
   - 顯示機密文件提示而非一般錯誤訊息

3. **新增狀態管理**
   ```typescript
   const showConfidentialModal = ref(false)
   ```

### 後端修改 (`src/api/documents/downloads.ts`)

1. **檔案 URL 驗證**
   - 檢查 `file_url` 是否為空
   - 檢查 `file_url` 是否為無效連結（如 `#`）
   - 返回 404 錯誤碼和明確的錯誤訊息

## 觸發條件

機密文件提示會在以下情況顯示：

1. 文件的 `file_url` 為空或無效
2. 文件不存在（404 錯誤）
3. 文件無法訪問（URL 無效）
4. 後端返回「文件不存在或不可下載」的錯誤訊息

## 使用者體驗

### 之前
- 點擊下載 → 瀏覽器顯示 404 錯誤頁面
- 使用者體驗不佳

### 之後
- 點擊下載 → 顯示美觀的提示視窗
- 明確告知這是機密文件
- 引導使用者聯繫管理員

## 視覺設計

```
┌─────────────────────────────────┐
│ ⚠️ 機密文件                  ✕ │
├─────────────────────────────────┤
│                                 │
│            🔒                   │
│                                 │
│      此為機密文件               │
│                                 │
│  此文件目前無法下載，如需存取   │
│  權限，請聯繫網站管理員。       │
│                                 │
├─────────────────────────────────┤
│        [ ✓ 我知道了 ]           │
└─────────────────────────────────┘
```

## 測試方式

1. **測試無效 URL 的文件**
   - 在資料庫中找到 `file_url` 為空或 `#` 的文件
   - 嘗試下載該文件
   - 應該顯示機密文件提示

2. **測試不存在的文件**
   - 嘗試下載一個不存在的文件 ID
   - 應該顯示機密文件提示

3. **測試正常文件**
   - 下載一個有效的文件
   - 應該正常開啟下載

## 相關檔案

- `src/views/DocumentsView.vue` - 前端文件頁面
- `src/api/documents/downloads.ts` - 後端下載路由
- `src/components/common/DocumentCard.vue` - 文件卡片元件

## 未來改進

1. 可以添加「聯繫管理員」按鈕，直接開啟郵件或聯繫表單
2. 可以記錄使用者嘗試訪問機密文件的日誌
3. 可以為不同類型的錯誤顯示不同的提示訊息

---

最後更新：2025-11-07
