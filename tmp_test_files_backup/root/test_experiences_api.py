#!/usr/bin/env python3
"""
æ¸¬è©¦ç¶“é©—åˆ†äº« API çš„è…³æœ¬
ç”¨æ–¼æ¸¬è©¦ POST /api/v1/experiences ç«¯é»
"""

import requests
import json

# API é…ç½®
API_URL = "https://c6d21c39.pharmacy-assistant-academy.pages.dev/api/v1/experiences"

# JWT Tokenï¼ˆå¾æ‚¨æä¾›çš„ curl å‘½ä»¤ä¸­å–å¾—ï¼‰
JWT_TOKEN = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjI2LCJlbWFpbCI6ImFkbWluQHR0cXMuY29tIiwidXNlclR5cGUiOiJhZG1pbiIsImlhdCI6MTc2MTk4NjgzOCwiZXhwIjoxNzYyMDczMjM4LCJhdWQiOiJwaGFybWFjeS1hc3Npc3RhbnQtYWNhZGVteS11c2VycyIsImlzcyI6InBoYXJtYWN5LWFzc2lzdGFudC1hY2FkZW15In0.hm2bq96t5WNr5vA8HzS5tFuh41YzUGziZ3bpiDhzI7s"

# æ¸¬è©¦ç”¨çš„ç¶“é©—åˆ†äº«è³‡æ–™
test_data = {
    "title": "å¤œç­è—¥å±€å·¥ä½œå¿ƒå¾—ï¼šæŒ‘æˆ°èˆ‡æ”¶ç©«ä¸¦å­˜çš„ç‰¹æ®Šé«”é©—",
    "content": """åœ¨å¤œç­è—¥å±€å·¥ä½œäº†8å€‹æœˆï¼Œæƒ³è·Ÿå¤§å®¶åˆ†äº«é€™å€‹ç‰¹æ®Šå·¥ä½œç’°å¢ƒçš„çœŸå¯¦é«”é©— ğŸŒ™

**ç‚ºä»€éº¼é¸æ“‡å¤œç­ï¼Ÿ**

åŸæœ¬åœ¨æ—¥ç­è—¥å±€å·¥ä½œï¼Œä½†å› ç‚ºï¼š
â€¢ è–ªè³‡è¼ƒé«˜ï¼ˆå¤œç­æ´¥è²¼ï¼‰
â€¢ ç«¶çˆ­ç›¸å°è¼ƒå°‘
â€¢ æƒ³æŒ‘æˆ°ä¸åŒçš„å·¥ä½œç’°å¢ƒ
â€¢ ç™½å¤©å¯ä»¥é€²ä¿®æˆ–è™•ç†å€‹äººäº‹å‹™

**å¤œç­å·¥ä½œçš„ç‰¹è‰²**

**å®¢ç¾¤ç‰¹æ€§**
â€¢ æ€¥è¨ºç—…æ‚£å®¶å±¬ï¼ˆæœ€å¸¸è¦‹ï¼‰
â€¢ è¼ªç­å·¥ä½œè€…ï¼ˆè­·ç†å¸«ã€ä¿å…¨ç­‰ï¼‰
â€¢ æ…¢æ€§ç—…æ‚£è£œè—¥
â€¢ ç·Šæ€¥éœ€è¦è—¥å“çš„æ°‘çœ¾

**å·¥ä½œå…§å®¹å·®ç•°**
â€¢ è™•æ–¹é‡ç›¸å°è¼ƒå°‘ä½†è¼ƒæ€¥è¿«
â€¢ éœ€è¦è™•ç†æ›´å¤šç·Šæ€¥ç‹€æ³
â€¢ è—¥å“è«®è©¢æ™‚é–“è¼ƒå……è£•
â€¢ æœ‰æ›´å¤šæ™‚é–“æ•´ç†å’Œå­¸ç¿’

**é¢è‡¨çš„æŒ‘æˆ°**

**ç”Ÿç†èª¿é©**
â€¢ ä½œæ¯é¡›å€’éœ€è¦æ™‚é–“é©æ‡‰
â€¢ ä¿æŒæ¸…é†’å’Œå°ˆæ³¨åŠ›
â€¢ é£²é£Ÿæ™‚é–“ä¸è¦å¾‹
â€¢ ç¤¾äº¤ç”Ÿæ´»å—åˆ°å½±éŸ¿

**å·¥ä½œå£“åŠ›**
â€¢ äººæ‰‹è¼ƒå°‘ï¼Œè²¬ä»»æ›´é‡
â€¢ é‡åˆ°ç·Šæ€¥ç‹€æ³éœ€è¦ç¨ç«‹è™•ç†
â€¢ æ·±å¤œæ™‚è—¥å¸«å¯èƒ½ä¸åœ¨ç¾å ´
â€¢ éœ€è¦æ›´å¼·çš„æ‡‰è®Šèƒ½åŠ›

**ç‰¹æ®Šæƒ…æ³è™•ç†**

**ç·Šæ€¥ç”¨è—¥**
æŸå¤©å‡Œæ™¨2é»ï¼Œæœ‰ä½åª½åª½å¸¶è‘—ç™¼é«˜ç‡’çš„å°å­©ä¾†è²·é€€ç‡’è—¥ã€‚å­©å­ç‡’åˆ°39åº¦ï¼Œåª½åª½éå¸¸ç„¦æ€¥ã€‚æˆ‘ç«‹åˆ»å”åŠ©æ‰¾åˆ°é©åˆçš„å…’ç«¥é€€ç‡’è—¥ï¼Œä¸¦è©³ç´°èªªæ˜ç”¨æ³•ç”¨é‡ï¼Œé‚„æé†’å¦‚æœæŒçºŒé«˜ç‡’è¦ç«‹å³å°±é†«ã€‚

**æ…¢æ€§ç—…æ‚£**
æœ‰ä½ç³–å°¿ç—…æ‚£è€…å› ç‚ºå¿˜è¨˜ç™½å¤©æ‹¿è—¥ï¼Œæ™šä¸Šè¡€ç³–ä¸ç©©å®šéœ€è¦ç·Šæ€¥ç”¨è—¥ã€‚æˆ‘å”åŠ©è¯çµ¡å€¼ç­è—¥å¸«ï¼Œç¢ºèªç”¨è—¥å®‰å…¨å¾Œæä¾›å”åŠ©ã€‚

**å·¥ä½œæŠ€å·§åˆ†äº«**

**ä¿æŒæ¸…é†’**
â€¢ é©é‡æ”å–å’–å•¡å› ï¼ˆä½†ä¸éé‡ï¼‰
â€¢ å®šæ™‚èµ·èº«æ´»å‹•
â€¢ ä¿æŒå·¥ä½œå€åŸŸæ˜äº®
â€¢ èˆ‡åŒäº‹é©åº¦èŠå¤©ä¿æŒç²¾ç¥

**æ•ˆç‡ç®¡ç†**
â€¢ åˆ©ç”¨ç©ºæª”æ™‚é–“å­¸ç¿’æ–°çŸ¥è­˜
â€¢ æ•´ç†è—¥å“å’Œç’°å¢ƒ
â€¢ æº–å‚™éš”å¤©çš„å·¥ä½œäº‹é …
â€¢ è¤‡ç¿’å¸¸è¦‹è—¥å“è³‡è¨Š

**å®‰å…¨è€ƒé‡**
â€¢ æ·±å¤œæ³¨æ„å€‹äººå®‰å…¨
â€¢ é‡åˆ°å¯ç–‘äººå“¡è¦æé«˜è­¦è¦º
â€¢ é‡è¦æ±ºå®šè¦èˆ‡è—¥å¸«ç¢ºèª
â€¢ ä¿æŒèˆ‡åŒäº‹çš„è¯ç¹«

**æ”¶ç©«èˆ‡æˆé•·**

**å°ˆæ¥­èƒ½åŠ›**
â€¢ ç¨ç«‹è™•ç†å•é¡Œçš„èƒ½åŠ›å¤§å¹…æå‡
â€¢ å°ç·Šæ€¥ç”¨è—¥æœ‰æ›´æ·±çš„äº†è§£
â€¢ å­¸æœƒåœ¨å£“åŠ›ä¸‹ä¿æŒå†·éœ
â€¢ æºé€šæŠ€å·§æ›´åŠ æˆç†Ÿ

**å€‹äººç™¼å±•**
â€¢ æŠ—å£“æ€§æ˜é¡¯å¢å¼·
â€¢ æ™‚é–“ç®¡ç†èƒ½åŠ›æ”¹å–„
â€¢ å­¸æœƒç…§é¡§è‡ªå·±çš„èº«é«”å¥åº·
â€¢ å°å·¥ä½œæœ‰æ›´æ·±çš„è²¬ä»»æ„Ÿ

**çµ¦è€ƒæ…®å¤œç­çš„æœ‹å‹å»ºè­°**

**é©åˆçš„äºº**
â€¢ å¤œè²“å­é«”è³ª
â€¢ æŠ—å£“æ€§å¼·
â€¢ å–œæ­¡æŒ‘æˆ°
â€¢ éœ€è¦è¼ƒé«˜æ”¶å…¥

**ä¸é©åˆçš„äºº**
â€¢ èº«é«”å¥åº·ç‹€æ³ä¸ä½³
â€¢ å®¶åº­è²¬ä»»è¼ƒé‡
â€¢ ç„¡æ³•é©æ‡‰ä½œæ¯æ”¹è®Š
â€¢ éœ€è¦è¦å¾‹ç¤¾äº¤ç”Ÿæ´»

**å¥åº·ç®¡ç†**

**ä½œæ¯èª¿æ•´**
â€¢ ä¸‹ç­å¾Œç«‹å³å›å®¶ä¼‘æ¯
â€¢ ä¿æŒæˆ¿é–“é»‘æš—å®‰éœ
â€¢ è¦å¾‹çš„ç¡çœ æ™‚é–“
â€¢ é©åº¦çš„é‹å‹•

**é£²é£Ÿæ³¨æ„**
â€¢ é¿å…æ²¹è†©å’Œåˆºæ¿€æ€§é£Ÿç‰©
â€¢ å¤šæ”å–è”¬æœå’Œè›‹ç™½è³ª
â€¢ å……è¶³çš„æ°´åˆ†è£œå……
â€¢ è¦å¾‹çš„ç”¨é¤æ™‚é–“

**æœªä¾†è¦åŠƒ**

é›–ç„¶å¤œç­å·¥ä½œæœ‰æŒ‘æˆ°ï¼Œä½†é€™æ®µç¶“é©—è®“æˆ‘æˆé•·å¾ˆå¤šã€‚ç›®å‰è¨ˆç•«ï¼š
â€¢ ç¹¼çºŒç´¯ç©å¤œç­ç¶“é©—1-2å¹´
â€¢ åˆ©ç”¨ç™½å¤©æ™‚é–“é€²ä¿®ç›¸é—œèª²ç¨‹
â€¢ è€ƒæ…®è½‰å›æ—¥ç­æˆ–å°‹æ±‚æ›´å¥½çš„ç™¼å±•æ©Ÿæœƒ
â€¢ å°‡å¤œç­ç¶“é©—ä½œç‚ºè·æ¶¯çš„åŠ åˆ†é …ç›®

**ç¸½çµ**

å¤œç­è—¥å±€å·¥ä½œä¸æ˜¯æ¯å€‹äººéƒ½é©åˆï¼Œä½†å¦‚æœä½ ï¼š
â€¢ æƒ³è¦æŒ‘æˆ°è‡ªå·±
â€¢ éœ€è¦è¼ƒé«˜çš„æ”¶å…¥
â€¢ å¸Œæœ›ç²å¾—æ›´å¤šç¨ç«‹å·¥ä½œçš„æ©Ÿæœƒ
â€¢ æƒ³åœ¨ç›¸å°ç«¶çˆ­è¼ƒå°‘çš„ç’°å¢ƒä¸­æˆé•·

é‚£éº¼å¤œç­å¯èƒ½æ˜¯ä¸€å€‹ä¸éŒ¯çš„é¸æ“‡ï¼

è¨˜ä½ï¼šä»»ä½•å·¥ä½œéƒ½æœ‰å…¶åƒ¹å€¼ï¼Œé‡è¦çš„æ˜¯æ‰¾åˆ°é©åˆè‡ªå·±çš„é“è·¯ï¼Œä¸¦åœ¨å…¶ä¸­åŠªåŠ›æˆé•· ğŸŒŸ""",
    "category": "job_experience",
    "tags": ["å¤œç­å·¥ä½œ", "å·¥ä½œå¿ƒå¾—", "è·å ´æŒ‘æˆ°"]
}


def test_create_experience():
    """æ¸¬è©¦å‰µå»ºç¶“é©—åˆ†äº«"""
    print("=" * 60)
    print("æ¸¬è©¦å‰µå»ºç¶“é©—åˆ†äº« API")
    print("=" * 60)
    
    headers = {
        "Content-Type": "application/json",
        "Authorization": f"Bearer {JWT_TOKEN}"
    }
    
    try:
        print(f"\nç™¼é€ POST è«‹æ±‚åˆ°: {API_URL}")
        print(f"æ¨™é¡Œ: {test_data['title']}")
        print(f"åˆ†é¡: {test_data['category']}")
        print(f"æ¨™ç±¤: {', '.join(test_data['tags'])}")
        
        response = requests.post(
            API_URL,
            headers=headers,
            json=test_data,
            timeout=30
        )
        
        print(f"\nç‹€æ…‹ç¢¼: {response.status_code}")
        print(f"å›æ‡‰æ¨™é ­: {dict(response.headers)}")
        
        try:
            response_data = response.json()
            print(f"\nå›æ‡‰å…§å®¹:")
            print(json.dumps(response_data, indent=2, ensure_ascii=False))
            
            if response.status_code == 200 or response.status_code == 201:
                if response_data.get('success'):
                    print("\nâœ… æ¸¬è©¦æˆåŠŸï¼ç¶“é©—åˆ†äº«å·²å‰µå»º")
                    if 'data' in response_data:
                        print(f"å‰µå»ºçš„ç¶“é©—åˆ†äº« ID: {response_data['data'].get('id', 'N/A')}")
                else:
                    print("\nâŒ æ¸¬è©¦å¤±æ•—ï¼šAPI è¿”å› success: false")
                    print(f"éŒ¯èª¤è¨Šæ¯: {response_data.get('error', {}).get('message', 'æœªçŸ¥éŒ¯èª¤')}")
            else:
                print(f"\nâŒ æ¸¬è©¦å¤±æ•—ï¼šHTTP ç‹€æ…‹ç¢¼ {response.status_code}")
                if 'error' in response_data:
                    print(f"éŒ¯èª¤è¨Šæ¯: {response_data['error'].get('message', 'æœªçŸ¥éŒ¯èª¤')}")
                    
        except json.JSONDecodeError:
            print(f"\nå›æ‡‰å…§å®¹ï¼ˆé JSONï¼‰:")
            print(response.text)
            
    except requests.exceptions.RequestException as e:
        print(f"\nâŒ è«‹æ±‚å¤±æ•—: {str(e)}")
    except Exception as e:
        print(f"\nâŒ ç™¼ç”ŸéŒ¯èª¤: {str(e)}")


def test_get_experiences():
    """æ¸¬è©¦ç²å–ç¶“é©—åˆ†äº«åˆ—è¡¨"""
    print("\n" + "=" * 60)
    print("æ¸¬è©¦ç²å–ç¶“é©—åˆ†äº«åˆ—è¡¨ API")
    print("=" * 60)
    
    try:
        print(f"\nç™¼é€ GET è«‹æ±‚åˆ°: {API_URL}")
        
        response = requests.get(API_URL, timeout=30)
        
        print(f"\nç‹€æ…‹ç¢¼: {response.status_code}")
        
        try:
            response_data = response.json()
            print(f"\nå›æ‡‰å…§å®¹:")
            print(json.dumps(response_data, indent=2, ensure_ascii=False))
            
            if response.status_code == 200:
                if response_data.get('success'):
                    experiences = response_data.get('data', [])
                    print(f"\nâœ… æˆåŠŸç²å– {len(experiences)} ç¯‡ç¶“é©—åˆ†äº«")
                    if experiences:
                        print(f"æœ€æ–°ä¸€ç¯‡æ¨™é¡Œ: {experiences[0].get('title', 'N/A')}")
                else:
                    print("\nâŒ æ¸¬è©¦å¤±æ•—ï¼šAPI è¿”å› success: false")
                    
        except json.JSONDecodeError:
            print(f"\nå›æ‡‰å…§å®¹ï¼ˆé JSONï¼‰:")
            print(response.text)
            
    except requests.exceptions.RequestException as e:
        print(f"\nâŒ è«‹æ±‚å¤±æ•—: {str(e)}")
    except Exception as e:
        print(f"\nâŒ ç™¼ç”ŸéŒ¯èª¤: {str(e)}")


if __name__ == "__main__":
    import sys
    
    if len(sys.argv) > 1:
        if sys.argv[1] == "get":
            test_get_experiences()
        elif sys.argv[1] == "post":
            test_create_experience()
        else:
            print("ç”¨æ³•: python test_experiences_api.py [get|post]")
            print("  ä¸æä¾›åƒæ•¸å‰‡åŒæ™‚åŸ·è¡Œå…©å€‹æ¸¬è©¦")
    else:
        # åŸ·è¡Œå…©å€‹æ¸¬è©¦
        test_create_experience()
        print("\n")
        test_get_experiences()

